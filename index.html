<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="manifest.json" />
  <title>Macro App (demo)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; max-width: 560px; }
    h1 { margin-bottom: .5rem; }
    .card { padding: 1rem; border: 1px solid #ddd; border-radius: .75rem; }
    label { display: block; margin: .5rem 0 .25rem; }
    input { width: 100%; padding: .5rem; border:1px solid #ccc; border-radius:.5rem; }
    .row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: .5rem; }
    button { margin-top: .75rem; padding:.6rem 1rem; border:1px solid #ddd; border-radius:.75rem; cursor:pointer; }
    .muted { color: #555; font-size: .9rem; }
    .totals { margin-top: 1rem; padding: .75rem; background: #f7f7f7; border-radius: .5rem; }
  </style>
</head>
<body>
  <h1>üçΩÔ∏è Macro Counter (demo)</h1>
  <p class="muted">Enter grams for one item, calculate, then ‚ÄúAdd to today‚Äù. It works offline and remembers today‚Äôs totals.</p>

  <div class="card">
    <div class="row">
      <div>
        <label>Protein (g)</label>
        <input id="p" type="number" min="0" step="1" value="0">
      </div>
      <div>
        <label>Carbs (g)</label>
        <input id="c" type="number" min="0" step="1" value="0">
      </div>
      <div>
        <label>Fat (g)</label>
        <input id="f" type="number" min="0" step="1" value="0">
      </div>
    </div>

    <button id="calc">Calculate kcal</button>
    <div id="result" class="totals" style="display:none;"></div>

    <button id="add" style="display:none;">Add to today</button>
    <button id="resetDay" style="display:none; margin-left:.5rem;">Reset today</button>

    <div id="today" class="totals" style="display:none;"></div>
  </div>

  <script>
    // --- tiny macro app ---
    const $ = (id) => document.getElementById(id);
    const keyForToday = () => 'totals-' + new Date().toISOString().slice(0,10); // e.g., totals-2025-08-23

    function readToday() {
      try { return JSON.parse(localStorage.getItem(keyForToday())) || { p:0, c:0, f:0, kcal:0 }; }
      catch { return { p:0, c:0, f:0, kcal:0 }; }
    }
    function writeToday(t) { localStorage.setItem(keyForToday(), JSON.stringify(t)); }

    function kcalOf(p,c,f){ return p*4 + c*4 + f*9; }

    function showToday() {
      const t = readToday();
      const box = $('today');
      box.style.display = 'block';
      box.innerHTML = `
        <strong>Today‚Äôs totals</strong><br>
        Protein: ${t.p} g ¬∑ Carbs: ${t.c} g ¬∑ Fat: ${t.f} g<br>
        Calories: ${t.kcal} kcal
      `;
      $('resetDay').style.display = (t.p||t.c||t.f) ? 'inline-block' : 'none';
    }

    $('calc').addEventListener('click', () => {
      const p = Math.max(0, Number($('p').value) || 0);
      const c = Math.max(0, Number($('c').value) || 0);
      const f = Math.max(0, Number($('f').value) || 0);
      const kcal = kcalOf(p,c,f);

      const r = $('result');
      r.style.display = 'block';
      r.innerHTML = `<strong>This item</strong><br>
        Protein: ${p} g ¬∑ Carbs: ${c} g ¬∑ Fat: ${f} g<br>
        Calories: ${kcal} kcal`;

      // stash current calc on the button for the add step
      $('add').dataset.p = p; $('add').dataset.c = c; $('add').dataset.f = f; $('add').dataset.kcal = kcal;
      $('add').style.display = 'inline-block';
    });

    $('add').addEventListener('click', () => {
      const t = readToday();
      t.p += Number($('add').dataset.p || 0);
      t.c += Number($('add').dataset.c || 0);
      t.f += Number($('add').dataset.f || 0);
      t.kcal += Number($('add').dataset.kcal || 0);
      writeToday(t);
      showToday();
    });

    $('resetDay').addEventListener('click', () => {
      localStorage.removeItem(keyForToday());
      showToday();
    });

    // on load, show any saved totals
    showToday();
  </script>

  <!-- keep your service worker registration here -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js', { scope: './' })
          .catch(err => console.error('SW registration failed:', err));
      });
    }
  </script>
</body>
</html>

